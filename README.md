# DiscordAuth

## Функционал

- Генерация кодов для привязки аккаунтов (`!generate <ник>`).
- Привязка аккаунта через код (`!link <код>`).
- Отвязка аккаунта (`!unlink`).
- Просмотр привязки (`!mylinks`).
- Админские команды: `!admin_unlink`, `!listlinks`.
- API для интеграции с Forge-модом (`/api/hasRole`, `/api/verifyCode`, `/api/unlink`).
- Хранение кодов в SQLite с резервным JSON.
- Ограничение: 1 Discord ID = 1 ник, с проверкой уникальности.
- Rate-limiting для команд и API.


## Принцип работы

### Ожидание игроков

- Мод на сервере Minecraft сохраняет список авторизованных игроков (по UUID).
- При заходе нового игрока, если его UUID не привязан к Discord-аккаунту, мод:
    1. Помещает игрока в "limbo" (блокируются команды, чат, инвентарь и т.п.).
    2. Показывает подсказку с просьбой авторизоваться через Discord.

### Генерация кода через Discord

- Пользователь в Discord пишет команду:  
  `!generate <mc_nick>`

- Discord-бот:
    1. Проверяет роль пользователя и что такой ник/Discord ещё не привязан.
    2. Генерирует одноразовый код (срок действия — 5 минут).
    3. Сохраняет в базе: (код, ник, discord_id, время истечения).
    4. Отправляет код пользователю в личные сообщения.

### Ввод кода на сервере

- Игрок в Minecraft вводит:  
  `/discordlink <код>`

- Мод отправляет HTTP-запрос к API бота (`/api/verifyCode`) с кодом и ником.

### Проверка на стороне бота

- API-бот принимает запрос от мода и проверяет:
    1. Что код существует.
    2. Что ник и discord_id совпадают.
    3. Что срок действия не истёк.
    4. Что у пользователя есть нужная роль в Discord.
- Если всё верно — возвращает успех и Discord ID.

### Привязка и снятие ограничений

- Мод сохраняет Discord ID как привязку к UUID игрока.
- Выводит игрока из "limbo" и разрешает обычную игру.

### Разрыв связи

- Если пользователь пишет `!unlink` или админ отвязывает через команду — бот удаляет запись в базе, и при следующем входе мод снова отправляет игрока в "limbo".
